



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation">
      
      
        <meta name="author" content="Percona LLC">
      
      
        <link rel="canonical" href="https://docs.percona.com/postgresql/solutions/pgbackrest.html">
      
      
        <link rel="prev" href="ha-setup-yum.html">
      
      
        <link rel="next" href="ha-test.html">
      
      
      <link rel="icon" href="../assets/postgresql-fav.svg">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.25">
    
    
      
        <title>pgBackRest setup - Percona Distribution for PostgreSQL</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.6543a935.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="https://unicons.iconscout.com/release/v3.0.3/css/line.css">
    
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css">
    
      <link rel="stylesheet" href="../css/extra.css">
    
      <link rel="stylesheet" href="../css/design.css">
    
      <link rel="stylesheet" href="../css/osano.css">
    
      <link rel="stylesheet" href="../css/postgresql.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-J4J70BNH0G"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-J4J70BNH0G",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-J4J70BNH0G",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
               
                 
                 
                 
                 
                 <meta property="og:type" content="website" />
                 <meta property="og:title" content="Percona Distribution for PostgreSQL - pgBackRest setup" />
                 <meta property="og:image" content="https://docs.percona.com/postgresql/13/_images/postgresql.png">
                 <meta property="og:url" content="https://docs.percona.com/postgresql/">
               </head>
                <body>
                </body>
              </html>
  
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#pgbackrest-setup" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      <!--
  Copyright (c) 2016-2024 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Determine classes -->


  


<!-- Header -->
<header class="md-header md-header--shadow" data-md-component="header">

  <!-- Super Nav -->
  <div class="superNav">
    <div class="md-header__inner md-grid">
      <a href="https://pmcf-percona.github.io/docs-home/" title="Percona Documentation home page">
        <svg width="24" height="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <mask id="a" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="24" height="24">
            <path d="M0 0h24v24H0z"/>
          </mask>
          <g mask="url(#a)">
            <path d="m7.825 13 5.6 5.6L12 20l-8-8 8-8 1.425 1.4-5.6 5.6H20v2H7.825Z"/>
          </g>
        </svg>
        <span>Percona Documentation</span>
      </a>
    </div>
  </div>

  <nav
    class="md-header__inner md-grid"
    aria-label="Header"
  >

    <!-- Link to home -->
    <a
      href="../index.html"
      title="Percona Distribution for PostgreSQL"
      class="md-header__button md-logo"
      aria-label="Percona Distribution for PostgreSQL"
      data-md-component="logo"
    >
      
  <img src="../assets/postgresql-mark.svg" alt="logo">

    </a>

    <!-- Button to open drawer -->
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>

    <!-- Header title -->
    <div class="md-header__title">
      <div class="md-header__ellipsis">
        <a href="../index.html" class="md-header__topic">
          <span class="md-ellipsis">
            Percona Distribution for PostgreSQL
          </span>
        </a>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              pgBackRest setup
            
          </span>
        </div>
      </div>
    </div>

    <!-- Color palette toggle -->
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Color theme set to Automatic. Click to change"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Color theme set to Automatic. Click to change" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9h-1.9M20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69m-9.15 3.96h2.3L12 9l-1.15 3.65Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="percona-light" data-md-color-primary="custom" data-md-color-accent="custom"  aria-label="Color theme set to Light Mode. Click to change"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Color theme set to Light Mode. Click to change" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="percona-dark" data-md-color-primary="custom" data-md-color-accent="custom"  aria-label="Color theme set to Dark Mode. Click to change"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Color theme set to Dark Mode. Click to change" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    

    <!-- User preference: color palette -->
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    

    <!-- Site language selector -->
    

    <!-- Button to open search modal -->
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>

      <!-- Search interface -->
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    

    <!-- Repository information -->
    
      <div class="md-header__source">
        <a href="https://github.com/percona/postgresql-docs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    percona/postgresql-docs
  </div>
</a>
      </div>
    
  </nav>

  <!-- Navigation tabs (sticky) -->
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="Percona Distribution for PostgreSQL" class="md-nav__button md-logo" aria-label="Percona Distribution for PostgreSQL" data-md-component="logo">
      
  <img src="../assets/postgresql-mark.svg" alt="logo">

    </a>
    Percona Distribution for PostgreSQL
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/percona/postgresql-docs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    percona/postgresql-docs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Release notes
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Release notes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../release-notes.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Release notes index
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../release-notes-v13.14.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Percona Distribution for PostgreSQL 13.14 (2024-03-07)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../release-notes-v13.13.upd.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Percona Distribution for PostgreSQL 13.13 Update (2024-01-19)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../release-notes-v13.13.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Percona Distribution for PostgreSQL 13.13 (2023-12-06)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../release-notes-v13.12.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Percona Distribution for PostgreSQL 13.12 (2023-08-30)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../release-notes-v13.11.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Percona Distribution for PostgreSQL 13.11 (2023-06-29)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../release-notes-v13.10.upd.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Percona Distribution for PostgreSQL 13.10 Update (2023-05-22)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../release-notes-v13.10.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Percona Distribution for PostgreSQL 13.10 (2023-03-27)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_9" >
        
          
          <label class="md-nav__link" for="__nav_2_9" id="__nav_2_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    2022 (versions 13.6 - 13.9)
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_9">
            <span class="md-nav__icon md-icon"></span>
            2022 (versions 13.6 - 13.9)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../release-notes-v13.9.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Percona Distribution for PostgreSQL 13.9 (2022-11-24)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../release-notes-v13.8.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Percona Distribution for PostgreSQL 13.8 (2022-09-06)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../release-notes-v13.7.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Percona Distribution for PostgreSQL 13.7 (2022-06-02)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../release-notes-v13.6.upd2.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Percona Distribution for PostgreSQL 13.6 Second Update (2022-05-05)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../release-notes-v13.6.upd.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Percona Distribution for PostgreSQL 13.6 Update (2022-04-14)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../release-notes-v13.6.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Percona Distribution for PostgreSQL 13.6 (2022-03-22)
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_10" >
        
          
          <label class="md-nav__link" for="__nav_2_10" id="__nav_2_10_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    2021 (versions 13.2 - 13.5)
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_10">
            <span class="md-nav__icon md-icon"></span>
            2021 (versions 13.2 - 13.5)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../release-notes-v13.5.upd2.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Percona Distribution for PostgreSQL 13.5 Second Update (2021-12-07)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../release-notes-v13.5.upd.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Percona Distribution for PostgreSQL 13.5 Update (2021-02-12)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../release-notes-v13.5.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Percona Distribution for PostgreSQL 13.5 (2021-11-23)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../release-notes-v13.4.upd.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Percona Distribution for PostgreSQL 13.4 Update (2021-09-30)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../release-notes-v13.4.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Percona Distribution for PostgreSQL 13.4 (2021-09-09)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../release-notes-v13.3.upd3.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Percona Distribution for PostgreSQL 13.3 Third Update (2021-07-15)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../release-notes-v13.3.upd2.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Percona Distribution for PostgreSQL 13.3 Second Update (2021-07-01)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../release-notes-v13.3.upd.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Percona Distribution for PostgreSQL 13.3 Update (2021-06-10)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../release-notes-v13.3.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Percona Distribution for PostgreSQL 13.3 (2021-05-20)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../release-notes-v13.2.upd4.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Percona Distribution for PostgreSQL 13.2 Fourth Update (2021-06-10)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../release-notes-v13.2.upd3.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Percona Distribution for PostgreSQL 13.2 Third Update (2021-05-10)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../release-notes-v13.2.upd2.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Percona Distribution for PostgreSQL 13.2 Second Update (2021-04-27)
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_11" >
        
          
          <label class="md-nav__link" for="__nav_2_11" id="__nav_2_11_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    2020 (versions 13.0 - 13.2)
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_11">
            <span class="md-nav__icon md-icon"></span>
            2020 (versions 13.0 - 13.2)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../release-notes-v13.2.upd.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Percona Distribution for PostgreSQL 13.2 Update (2021-04-12)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../release-notes-v13.2.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Percona Distribution for PostgreSQL 13.2 (2021-03-04)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../release-notes-v13.1.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Percona Distribution for PostgreSQL 13.1 (2020-12-02)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../release-notes-v13.0.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Percona Distribution for PostgreSQL 13.0 (2020-10-16)
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Installation and Upgrade
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Installation and Upgrade
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Install Percona Distribution for PostgreSQL
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            Install Percona Distribution for PostgreSQL
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../installing.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../apt.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Install via apt
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../yum.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Install via yum
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../enable-extensions.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Enable Percona Distribution for PostgreSQL extensions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../repo-overview.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Repositories overview
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../docker.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Run in Docker
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../migration.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Migrate from PostgreSQL to Percona Distribution for PostgreSQL
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../major-upgrade.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Upgrading Percona Distribution for PostgreSQL from 12 to 13
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../minor-upgrade.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Minor Upgrade of Percona Distribution for PostgreSQL
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Extensions
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Extensions
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pg-stat-monitor.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pg_stat_monitor
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Solutions
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Solutions
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_1" checked>
        
          
          <label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    High availability
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5_1">
            <span class="md-nav__icon md-icon"></span>
            High availability
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="high-availability.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    High availability
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="ha-setup-apt.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deploying on Debian or Ubuntu
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="ha-setup-yum.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deploying on RHEL or derivatives
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    pgBackRest setup
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="pgbackrest.html" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    pgBackRest setup
  </span>
  

      </a>
      
        

  

<nav class="md-nav md-nav--secondary" aria-label="On this page">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      On this page
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#configure-backup-server" class="md-nav__link">
    <span class="md-ellipsis">
      Configure backup server
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configure backup server">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install-pgbackrest" class="md-nav__link">
    <span class="md-ellipsis">
      Install pgBackRest
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-the-configuration-file" class="md-nav__link">
    <span class="md-ellipsis">
      Create the configuration file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-the-certificate-files" class="md-nav__link">
    <span class="md-ellipsis">
      Create the certificate files
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-database-servers" class="md-nav__link">
    <span class="md-ellipsis">
      Configure database servers
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-backups" class="md-nav__link">
    <span class="md-ellipsis">
      Create backups
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#get-expert-help" class="md-nav__link">
    <span class="md-ellipsis">
      Get expert help
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="ha-test.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Testing the Patroni PostgreSQL Cluster
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Backup and disaster recovery
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            Backup and disaster recovery
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="backup-recovery.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Backup and disaster recovery
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="dr-pgbackrest-setup.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deploying backup and disaster recovery solution in Percona Distribution for PostgreSQL
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_3" >
        
          
          <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Spatial data handling
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            Spatial data handling
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="postgis.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="postgis-deploy.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deployment
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="postgis-testing.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Query spatial data
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="postgis-upgrade.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Upgrade spatial database
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_4" >
        
          
          <label class="md-nav__link" for="__nav_5_4" id="__nav_5_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    LDAP authentication
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4">
            <span class="md-nav__icon md-icon"></span>
            LDAP authentication
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ldap.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    LDAP Authentication
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../telemetry.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Telemetry
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../uninstalling.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Uninstall
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../licensing.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Licensing
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Trademark policy
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            Trademark policy
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../trademark-policy.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Trademark Policy
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                    <br>
                    <label class="md-nav__title" for="__drawer">
    <a href="https://learn.percona.com/download-manual-percona-distribution-for-postgresql-13" onclick="_gaq.push(['b._trackEvent', 'Percona Distribution for PostgreSQL', 'Download', 'Download Manual Percona Distribution for PostgreSQL']);" class="md-nav__link md-nav__link--active" style="font-size: .7rem;">
      Download PDF
    </a>
  </label> 
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  

<nav class="md-nav md-nav--secondary" aria-label="On this page">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      On this page
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#configure-backup-server" class="md-nav__link">
    <span class="md-ellipsis">
      Configure backup server
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Configure backup server">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install-pgbackrest" class="md-nav__link">
    <span class="md-ellipsis">
      Install pgBackRest
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-the-configuration-file" class="md-nav__link">
    <span class="md-ellipsis">
      Create the configuration file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-the-certificate-files" class="md-nav__link">
    <span class="md-ellipsis">
      Create the certificate files
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#configure-database-servers" class="md-nav__link">
    <span class="md-ellipsis">
      Configure database servers
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-backups" class="md-nav__link">
    <span class="md-ellipsis">
      Create backups
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#get-expert-help" class="md-nav__link">
    <span class="md-ellipsis">
      Get expert help
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
    <a href="https://github.com/percona/postgresql-docs/edit/13/docs/solutions/pgbackrest.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/percona/postgresql-docs/raw/13/docs/solutions/pgbackrest.md" title="View source of this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.15 8.15 0 0 1-1.23-2Z"/></svg>
    </a>
  


<h1 id="pgbackrest-setup">pgBackRest setup<a class="headerlink" href="#pgbackrest-setup" title="Permanent link">&para;</a></h1>
<p>pgBackRest is the backup tool used to perform Postgres database backup, restoration, and point-in-time recovery. It is a server-client application, where the server runs on a dedicated host and a client runs on every PostgreSQL node. </p>
<p>You also need a backup storage to store the backups. It can either be a remote storage such as AWS S3, S3-compatible storages or Azure blob storage, or a filesystem-based one. </p>
<h2 id="configure-backup-server">Configure backup server<a class="headerlink" href="#configure-backup-server" title="Permanent link">&para;</a></h2>
<h3 id="install-pgbackrest">Install pgBackRest<a class="headerlink" href="#install-pgbackrest" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>Enable the repository with <a href="https://www.percona.com/doc/percona-repo-config/index.html">percona-release</a></p>
<div class="highlight" data-prompt="$"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>percona-release<span class="w"> </span>setup<span class="w"> </span>ppg-11<span class="w">       </span>
</code></pre></div>
</li>
<li>
<p>Install pgBackRest package</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">Debian/Ubuntu</label><label for="__tabbed_1_2">RHEL/derivatives</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight" data-prompt="$"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>percona-pgbackrest
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight" data-prompt="$"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>yum<span class="w"> </span>install<span class="w"> </span>percona-pgbackrest
</code></pre></div>
</div>
</div>
</div>
</li>
</ol>
<h3 id="create-the-configuration-file">Create the configuration file<a class="headerlink" href="#create-the-configuration-file" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>Create environment variables to simplify the config file creation:</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">SRV_NAME</span><span class="o">=</span><span class="s2">&quot;bkp-srv&quot;</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">NODE1_NAME</span><span class="o">=</span><span class="s2">&quot;node-1&quot;</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">NODE2_NAME</span><span class="o">=</span><span class="s2">&quot;node-2&quot;</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">NODE3_NAME</span><span class="o">=</span><span class="s2">&quot;node-3&quot;</span>
</code></pre></div>
</li>
<li>
<p>Create the <code>pgBackRest</code> repository</p>
<p>A repository is where <code>pgBackRest</code> stores backups. In this example, the backups will be saved to <code>/var/lib/pgbackrest</code></p>
<div class="highlight" data-prompt="$"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/var/lib/pgbackrest
$<span class="w"> </span>sudo<span class="w"> </span>chmod<span class="w"> </span><span class="m">750</span><span class="w"> </span>/var/lib/pgbackrest
$<span class="w"> </span>sudo<span class="w"> </span>chown<span class="w"> </span>postgres:postgres<span class="w"> </span>/var/lib/pgbackrest
</code></pre></div>
</li>
<li>
<p>The default pgBackRest configuration file location is <code>/etc/pgbackrest/pgbackrest.conf</code>. If it does not exist, then <code>/etc/pgbackrest.conf</code> is used next. Edit the <code>pgbackrest.conf</code> file to include the following configuration:</p>
<div class="highlight"><pre><span></span><code>[global] 

# Server repo details
repo1-path=/var/lib/pgbackrest 

### Retention ###
#  - repo1-retention-archive-type
#  - If set to full pgBackRest will keep archive logs for the number of full backups defined by repo-retention-archive
repo1-retention-archive-type=full 

# repo1-retention-archive
#  - Number of backups worth of continuous WAL to retain
#  - NOTE: WAL segments required to make a backup consistent are always retained until the backup is expired regardless of how this option is configured
#  - If this value is not set and repo-retention-full-type is count (default), then the archive to expire will default to the repo-retention-full
# repo1-retention-archive=2 

# repo1-retention-full
#  - Full backup retention count/time.
#  - When a full backup expires, all differential and incremental backups associated with the full backup will also expire. 
#  - When the option is not defined a warning will be issued. 
#  - If indefinite retention is desired then set the option to the max value. 
repo1-retention-full=4 

# Server general options
process-max=12
log-level-console=info
#log-level-file=debug
log-level-file=info
start-fast=y
delta=y
backup-standby=y 

########## Server TLS options ##########
tls-server-address=*
tls-server-cert-file=/pg_ha/certs/${SRV_NAME}.crt
tls-server-key-file=/pg_ha/certs/${SRV_NAME}.key
tls-server-ca-file=/pg_ha/certs/ca.crt 

### Auth entry ###
tls-server-auth=${NODE1_NAME}=cluster_1
tls-server-auth=${NODE2_NAME}=cluster_1
tls-server-auth=${NODE3_NAME}=cluster_1 

### Clusters and nodes ###
[cluster_1]
pg1-host=${NODE1_NAME}
pg1-host-port=8432
pg1-port=5432
pg1-path=/var/lib/postgresql/11/
pg1-host-type=tls
pg1-host-cert-file=/pg_ha/certs/${SRV_NAME}.crt
pg1-host-key-file=/pg_ha/certs/${SRV_NAME}.key
pg1-host-ca-file=/pg_ha/certs/ca.crt
pg1-socket-path=/var/run/postgresql 


pg2-host=${NODE2_NAME}
pg2-host-port=8432
pg2-port=5432
pg2-path=/var/lib/postgresql/11/
pg2-host-type=tls
pg2-host-cert-file=/pg_ha/certs/${SRV_NAME}.crt
pg2-host-key-file=/pg_ha/certs/${SRV_NAME}.key
pg2-host-ca-file=/pg_ha/certs/ca.crt
pg2-socket-path=/var/run/postgresql 

pg3-host=${NODE3_NAME}
pg3-host-port=8432
pg3-port=5432
pg3-path=/var/lib/postgresql/11/
pg3-host-type=tls
pg3-host-cert-file=/pg_ha/certs/${SRV_NAME}.crt
pg3-host-key-file=/pg_ha/certs/${SRV_NAME}.key
pg3-host-ca-file=/pg_ha/certs/ca.crt
pg3-socket-path=/var/run/postgresql
</code></pre></div>
</li>
<li>
<p>Create the <code>systemd</code> unit file at the path <code>/etc/systemd/system/pgbackrest.service</code></p>
<div class="highlight"><span class="filename">/etc/systemd/system/pgbackrest.service</span><pre><span></span><code><span class="k">[Unit]</span>
<span class="na">Description</span><span class="o">=</span><span class="s">pgBackRest Server</span>
<span class="na">After</span><span class="o">=</span><span class="s">network.target</span>
<span class="na">StartLimitIntervalSec</span><span class="o">=</span><span class="s">0</span>

<span class="k">[Service]</span>
<span class="na">Type</span><span class="o">=</span><span class="s">simple</span>
<span class="na">User</span><span class="o">=</span><span class="s">postgres</span>
<span class="na">Restart</span><span class="o">=</span><span class="s">always</span>
<span class="na">RestartSec</span><span class="o">=</span><span class="s">1</span>
<span class="na">ExecStart</span><span class="o">=</span><span class="s">/usr/bin/pgbackrest server</span>
<span class="c1">#ExecStartPost=/bin/sleep 3</span>
<span class="c1">#ExecStartPost=/bin/bash -c &quot;[ ! -z $MAINPID ]&quot;</span>
<span class="na">ExecReload</span><span class="o">=</span><span class="s">/bin/kill -HUP $MAINPID</span>

<span class="k">[Install]</span>
<span class="na">WantedBy</span><span class="o">=</span><span class="s">multi-user.target</span>
</code></pre></div>
</li>
</ol>
<h3 id="create-the-certificate-files">Create the certificate files<a class="headerlink" href="#create-the-certificate-files" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p>Create the folder where to store the certificates. For example, <code>/pg_ha/certs</code></p>
</li>
<li>
<p>Define the variable for the certificates path:</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">CA_PATH</span><span class="o">=</span><span class="s2">&quot;/pg_ha/certs&quot;</span>
</code></pre></div>
</li>
<li>
<p>Create the certificates and keys</p>
<div class="highlight" data-prompt="$"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>-iu<span class="w"> </span>postgres<span class="w"> </span>openssl<span class="w"> </span>req<span class="w"> </span>-new<span class="w"> </span>-x509<span class="w"> </span>-days<span class="w"> </span><span class="m">365</span><span class="w"> </span>-nodes<span class="w"> </span>-out<span class="w"> </span><span class="si">${</span><span class="nv">CA_PATH</span><span class="si">}</span>/ca.crt<span class="w"> </span>-keyout<span class="w"> </span><span class="si">${</span><span class="nv">CA_PATH</span><span class="si">}</span>/ca.key<span class="w"> </span>-subj<span class="w"> </span><span class="s2">&quot;/CN=root-ca&quot;</span>
</code></pre></div>
</li>
<li>
<p>Create the certificate for the backup server</p>
<div class="highlight" data-prompt="$"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>-iu<span class="w"> </span>postgres<span class="w"> </span>openssl<span class="w"> </span>req<span class="w"> </span>-new<span class="w"> </span>-nodes<span class="w"> </span>-out<span class="w"> </span><span class="si">${</span><span class="nv">CA_PATH</span><span class="si">}</span>/<span class="si">${</span><span class="nv">SRV_NAME</span><span class="si">}</span>.csr<span class="w"> </span>-keyout<span class="w"> </span><span class="si">${</span><span class="nv">CA_PATH</span><span class="si">}</span>/<span class="si">${</span><span class="nv">SRV_NAME</span><span class="si">}</span>.key<span class="w"> </span>-subj<span class="w"> </span><span class="s2">&quot;/CN=</span><span class="si">${</span><span class="nv">SRV_NAME</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div>
</li>
<li>
<p>Create the certificates for each node: <code>node1</code>, <code>node2</code>, <code>node3</code></p>
<div class="highlight" data-prompt="$"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>-iu<span class="w"> </span>postgres<span class="w"> </span>openssl<span class="w"> </span>req<span class="w"> </span>-new<span class="w"> </span>-nodes<span class="w"> </span>-out<span class="w"> </span><span class="si">${</span><span class="nv">CA_PATH</span><span class="si">}</span>/<span class="si">${</span><span class="nv">NODE1_NAME</span><span class="si">}</span>.csr<span class="w"> </span>-keyout<span class="w"> </span><span class="si">${</span><span class="nv">CA_PATH</span><span class="si">}</span>/<span class="si">${</span><span class="nv">NODE1_NAME</span><span class="si">}</span>.key<span class="w"> </span>-subj<span class="w"> </span><span class="s2">&quot;/CN=</span><span class="si">${</span><span class="nv">NODE1_NAME</span><span class="si">}</span><span class="s2">&quot;</span>
$<span class="w"> </span>sudo<span class="w"> </span>-iu<span class="w"> </span>postgres<span class="w"> </span>openssl<span class="w"> </span>req<span class="w"> </span>-new<span class="w"> </span>-nodes<span class="w"> </span>-out<span class="w"> </span><span class="si">${</span><span class="nv">CA_PATH</span><span class="si">}</span>/<span class="si">${</span><span class="nv">NODE2_NAME</span><span class="si">}</span>.csr<span class="w"> </span>-keyout<span class="w"> </span><span class="si">${</span><span class="nv">CA_PATH</span><span class="si">}</span>/<span class="si">${</span><span class="nv">NODE2_NAME</span><span class="si">}</span>.key<span class="w"> </span>-subj<span class="w"> </span><span class="s2">&quot;/CN=</span><span class="si">${</span><span class="nv">NODE2_NAME</span><span class="si">}</span><span class="s2">&quot;</span>
$<span class="w"> </span>sudo<span class="w"> </span>-iu<span class="w"> </span>postgres<span class="w"> </span>openssl<span class="w"> </span>req<span class="w"> </span>-new<span class="w"> </span>-nodes<span class="w"> </span>-out<span class="w"> </span><span class="si">${</span><span class="nv">CA_PATH</span><span class="si">}</span>/<span class="si">${</span><span class="nv">NODE3_NAME</span><span class="si">}</span>.csr<span class="w"> </span>-keyout<span class="w"> </span><span class="si">${</span><span class="nv">CA_PATH</span><span class="si">}</span>/<span class="si">${</span><span class="nv">NODE3_NAME</span><span class="si">}</span>.key<span class="w"> </span>-subj<span class="w"> </span><span class="s2">&quot;/CN=</span><span class="si">${</span><span class="nv">NODE3_NAME</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div>
</li>
<li>
<p>Sign the certificates with the <code>root-ca</code> key</p>
<div class="highlight" data-prompt="$"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>-iu<span class="w"> </span>postgres<span class="w"> </span>openssl<span class="w"> </span>x509<span class="w"> </span>-req<span class="w"> </span>-in<span class="w"> </span><span class="si">${</span><span class="nv">CA_PATH</span><span class="si">}</span>/<span class="si">${</span><span class="nv">SRV_NAME</span><span class="si">}</span>.csr<span class="w"> </span>-days<span class="w"> </span><span class="m">365</span><span class="w"> </span>-CA<span class="w"> </span><span class="si">${</span><span class="nv">CA_PATH</span><span class="si">}</span>/ca.crt<span class="w"> </span>-CAkey<span class="w"> </span><span class="si">${</span><span class="nv">CA_PATH</span><span class="si">}</span>/ca.key<span class="w"> </span>-CAcreateserial<span class="w"> </span>-out<span class="w"> </span><span class="si">${</span><span class="nv">CA_PATH</span><span class="si">}</span>/<span class="si">${</span><span class="nv">SRV_NAME</span><span class="si">}</span>.crt
$<span class="w"> </span>sudo<span class="w"> </span>-iu<span class="w"> </span>postgres<span class="w"> </span>openssl<span class="w"> </span>x509<span class="w"> </span>-req<span class="w"> </span>-in<span class="w"> </span><span class="si">${</span><span class="nv">CA_PATH</span><span class="si">}</span>/<span class="si">${</span><span class="nv">NODE1_NAME</span><span class="si">}</span>.csr<span class="w"> </span>-days<span class="w"> </span><span class="m">365</span><span class="w"> </span>-CA<span class="w"> </span><span class="si">${</span><span class="nv">CA_PATH</span><span class="si">}</span>/ca.crt<span class="w"> </span>-CAkey<span class="w"> </span><span class="si">${</span><span class="nv">CA_PATH</span><span class="si">}</span>/ca.key<span class="w"> </span>-CAcreateserial<span class="w"> </span>-out<span class="w"> </span><span class="si">${</span><span class="nv">CA_PATH</span><span class="si">}</span>/<span class="si">${</span><span class="nv">NODE1_NAME</span><span class="si">}</span>.crt
$<span class="w"> </span>sudo<span class="w"> </span>-iu<span class="w"> </span>postgres<span class="w"> </span>openssl<span class="w"> </span>x509<span class="w"> </span>-req<span class="w"> </span>-in<span class="w"> </span><span class="si">${</span><span class="nv">CA_PATH</span><span class="si">}</span>/<span class="si">${</span><span class="nv">NODE2_NAME</span><span class="si">}</span>.csr<span class="w"> </span>-days<span class="w"> </span><span class="m">365</span><span class="w"> </span>-CA<span class="w"> </span><span class="si">${</span><span class="nv">CA_PATH</span><span class="si">}</span>/ca.crt<span class="w"> </span>-CAkey<span class="w"> </span><span class="si">${</span><span class="nv">CA_PATH</span><span class="si">}</span>/ca.key<span class="w"> </span>-CAcreateserial<span class="w"> </span>-out<span class="w"> </span><span class="si">${</span><span class="nv">CA_PATH</span><span class="si">}</span>/<span class="si">${</span><span class="nv">NODE2_NAME</span><span class="si">}</span>.crt
$<span class="w"> </span>sudo<span class="w"> </span>-iu<span class="w"> </span>postgres<span class="w"> </span>openssl<span class="w"> </span>x509<span class="w"> </span>-req<span class="w"> </span>-in<span class="w"> </span><span class="si">${</span><span class="nv">CA_PATH</span><span class="si">}</span>/<span class="si">${</span><span class="nv">NODE3_NAME</span><span class="si">}</span>.csr<span class="w"> </span>-days<span class="w"> </span><span class="m">365</span><span class="w"> </span>-CA<span class="w"> </span><span class="si">${</span><span class="nv">CA_PATH</span><span class="si">}</span>/ca.crt<span class="w"> </span>-CAkey<span class="w"> </span><span class="si">${</span><span class="nv">CA_PATH</span><span class="si">}</span>/ca.key<span class="w"> </span>-CAcreateserial<span class="w"> </span>-out<span class="w"> </span><span class="si">${</span><span class="nv">CA_PATH</span><span class="si">}</span>/<span class="si">${</span><span class="nv">NODE3_NAME</span><span class="si">}</span>.crt
</code></pre></div>
</li>
<li>
<p>Remove temporary files</p>
<div class="highlight" data-prompt="$"><pre><span></span><code>$<span class="w"> </span>rm<span class="w"> </span><span class="si">${</span><span class="nv">CA_PATH</span><span class="si">}</span>/*.csr
</code></pre></div>
</li>
<li>
<p>Reload, enable, and start the service</p>
<div class="highlight" data-prompt="$"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>systemctl<span class="w"> </span>daemon-reload
$<span class="w"> </span>sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>--now<span class="w"> </span>pgbackrest
</code></pre></div>
</li>
</ol>
<h2 id="configure-database-servers">Configure database servers<a class="headerlink" href="#configure-database-servers" title="Permanent link">&para;</a></h2>
<p>Run the following command on <code>node1</code>, <code>node2</code> and <code>node3</code>.</p>
<ol>
<li>
<p>Create the certificates folder. For example, <code>/pg_ha/certs</code> </p>
<div class="highlight" data-prompt="$"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/pg_ha/certs
</code></pre></div>
</li>
<li>
<p>Export environment variables to simplify config file creation</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">NODE_NAME</span><span class="o">=</span><span class="sb">`</span>hostname<span class="w"> </span>-f<span class="sb">`</span>
</code></pre></div>
</li>
<li>
<p>Create the configuration file. The default path is <code>/etc/pgbackrest.conf</code></p>
<div class="highlight"><span class="filename">/etc/pgbackrest.conf</span><pre><span></span><code><span class="k">[global]</span>
<span class="na">repo1-host</span><span class="o">=</span><span class="s">bkp-srv</span>
<span class="na">repo1-host-user</span><span class="o">=</span><span class="s">postgres</span>
<span class="na">repo1-host-type</span><span class="o">=</span><span class="s">tls</span>
<span class="na">repo1-host-cert-file</span><span class="o">=</span><span class="s">/pg_ha/certs/${NODE_NAME}.crt</span>
<span class="na">repo1-host-key-file</span><span class="o">=</span><span class="s">/pg_ha/certs/${NODE_NAME}.key</span>
<span class="na">repo1-host-ca-file</span><span class="o">=</span><span class="s">/pg_ha/certs/ca.crt</span>

<span class="c1"># general options</span>
<span class="na">process-max</span><span class="o">=</span><span class="s">16</span>
<span class="na">log-level-console</span><span class="o">=</span><span class="s">info</span>
<span class="na">log-level-file</span><span class="o">=</span><span class="s">debug</span>

<span class="c1"># tls server options</span>
<span class="na">tls-server-address</span><span class="o">=</span><span class="s">*</span>
<span class="na">tls-server-cert-file</span><span class="o">=</span><span class="s">/pg_ha/certs/${NODE_NAME}.crt</span>
<span class="na">tls-server-key-file</span><span class="o">=</span><span class="s">/pg_ha/certs/${NODE_NAME}.key</span>
<span class="na">tls-server-ca-file</span><span class="o">=</span><span class="s">/pg_ha/certs/ca.crt</span>
<span class="na">tls-server-auth</span><span class="o">=</span><span class="s">bkp-srv=cluster_1</span>

<span class="k">[cluster_1]</span>
<span class="na">pg1-path</span><span class="o">=</span><span class="s">/var/lib/postgresql/11</span>
</code></pre></div>
</li>
<li>
<p>Create the <code>systemd</code> unit file at the path <code>/etc/systemd/system/pgbackrest.service</code></p>
<div class="highlight"><span class="filename">/etc/systemd/system/pgbackrest.service</span><pre><span></span><code><span class="k">[Unit]</span>
<span class="na">Description</span><span class="o">=</span><span class="s">pgBackRest Server</span>
<span class="na">After</span><span class="o">=</span><span class="s">network.target</span>
<span class="na">StartLimitIntervalSec</span><span class="o">=</span><span class="s">0</span>

<span class="k">[Service]</span>
<span class="na">Type</span><span class="o">=</span><span class="s">simple</span>
<span class="na">User</span><span class="o">=</span><span class="s">postgres</span>
<span class="na">Restart</span><span class="o">=</span><span class="s">always</span>
<span class="na">RestartSec</span><span class="o">=</span><span class="s">1</span>
<span class="na">ExecStart</span><span class="o">=</span><span class="s">/usr/bin/pgbackrest server</span>
<span class="c1">#ExecStartPost=/bin/sleep 3</span>
<span class="c1">#ExecStartPost=/bin/bash -c &quot;[ ! -z $MAINPID ]&quot;</span>
<span class="na">ExecReload</span><span class="o">=</span><span class="s">/bin/kill -HUP $MAINPID</span>

<span class="k">[Install]</span>
<span class="na">WantedBy</span><span class="o">=</span><span class="s">multi-user.target</span>
</code></pre></div>
</li>
<li>
<p>Reload, enable, and start the service</p>
<div class="highlight" data-prompt="$"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>systemctl<span class="w"> </span>daemon-reload
$<span class="w"> </span>sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>--now<span class="w"> </span>pgbackrest
</code></pre></div>
</li>
<li>
<p>Change Patroni configuration to use pgBackRest. Run this command on one node only, for example, on <code>node1</code>. Edit the <code>/etc/patroni/patroni.yml</code> file :</p>
<div class="highlight"><span class="filename">/etc/patroni/patroni.yml</span><pre><span></span><code><span class="nt">loop_wait</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="nt">maximum_lag_on_failover</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1048576</span>
<span class="nt">postgresql</span><span class="p">:</span>
<span class="w">  </span><span class="nt">parameters</span><span class="p">:</span>
<span class="w">    </span><span class="nt">archive_command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pgbackrest --stanza=cluster_1 archive-push &quot;/var/lib/postgresql/15/main/pg_wal/%f&quot;</span>
<span class="w">    </span><span class="nt">archive_mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">archive_timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1800s</span>
<span class="w">    </span><span class="nt">hot_standby</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">    </span><span class="nt">logging_collector</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;on&#39;</span>
<span class="w">    </span><span class="nt">max_replication_slots</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="w">    </span><span class="nt">max_wal_senders</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
<span class="w">    </span><span class="nt">wal_keep_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4096</span>
<span class="w">    </span><span class="nt">wal_level</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">logical</span>
<span class="w">    </span><span class="nt">wal_log_hints</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">recovery_conf</span><span class="p">:</span>
<span class="w">    </span><span class="nt">recovery_target_timeline</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">latest</span>
<span class="w">    </span><span class="nt">restore_command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pgbackrest --config=/etc/pgbackrest.conf --stanza=cluster_1 archive-get %f &quot;%p&quot;</span>
<span class="w">  </span><span class="nt">use_pg_rewind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">  </span><span class="nt">use_slots</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="nt">retry_timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="nt">slots</span><span class="p">:</span>
<span class="w">  </span><span class="nt">percona_cluster_1</span><span class="p">:</span>
<span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">physical</span>
<span class="nt">ttl</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30</span>
</code></pre></div>
</li>
</ol>
<h2 id="create-backups">Create backups<a class="headerlink" href="#create-backups" title="Permanent link">&para;</a></h2>
<p>Run the following commands on the <strong>backup server</strong></p>
<ol>
<li>
<p>Create the stanza. A stanza is the configuration for a PostgreSQL database cluster that defines where it is located, how it will be backed up, archiving options, etc. </p>
<div class="highlight" data-prompt="$"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>-iu<span class="w"> </span>postgres<span class="w"> </span>pgbackrest<span class="w"> </span>--stanza<span class="o">=</span>cluster_1<span class="w"> </span>stanza-create
</code></pre></div>
</li>
<li>
<p>Create a full backup</p>
<div class="highlight" data-prompt="$"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>-iu<span class="w"> </span>postgres<span class="w"> </span>pgbackrest<span class="w"> </span>--stanza<span class="o">=</span>cluster_1<span class="w"> </span>--type<span class="o">=</span>full<span class="w"> </span>backup
</code></pre></div>
</li>
<li>
<p>Create an incremental backup</p>
<div class="highlight" data-prompt="$"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>-iu<span class="w"> </span>postgres<span class="w"> </span>pgbackrest<span class="w"> </span>--stanza<span class="o">=</span>cluster_1<span class="w"> </span>--type<span class="o">=</span>incr<span class="w"> </span>backup
</code></pre></div>
</li>
<li>
<p>Check backup info</p>
<div class="highlight" data-prompt="$"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>-iu<span class="w"> </span>postgres<span class="w"> </span>pgbackrest<span class="w"> </span>--stanza<span class="o">=</span>cluster_1<span class="w"> </span>info
</code></pre></div>
</li>
<li>
<p>Expire (remove) a backup. Be careful with removal, because removing a full backup also removes dependent incremental backups </p>
<div class="highlight" data-prompt="$"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>-iu<span class="w"> </span>postgres<span class="w"> </span>pgbackrest<span class="w"> </span>--stanza<span class="o">=</span>cluster_1<span class="w"> </span>expire<span class="w"> </span>--set<span class="o">=</span><span class="m">20230617</span>-021338F
</code></pre></div>
</li>
</ol>
<p><a class="md-button" href="ha-test.html">Test PostgreSQL cluster</a></p>
<div data-banner="data-banner">
<h2 class="title" id="get-expert-help">Get expert help<a class="headerlink" href="#get-expert-help" title="Permanent link">&para;</a></h2>
<p>If you need assistance, visit the community forum for comprehensive and free database knowledge, or contact our Percona Database Experts for professional support and services.</p>
<div class="actions">
<p><a href="https://forums.percona.com/c/postgresql/25?utm_campaign=Doc%20pages"><span class="twemoji"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M15 4v7H5.17L4 12.17V4h11m1-2H3a1 1 0 0 0-1 1v14l4-4h10a1 1 0 0 0 1-1V3a1 1 0 0 0-1-1m5 4h-2v9H6v2a1 1 0 0 0 1 1h11l4 4V7a1 1 0 0 0-1-1Z"/></svg></span> Community Forum</a> <a href="https://www.percona.com/about/contact"><span class="twemoji"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
    <path d="M19.3996 14.148C21.9082 12.5083 22.7289 9.16368 21.2109 6.53493C20.4502 5.21636 19.2207 4.27206 17.7497 3.87776C16.3868 3.51187 14.9634 3.6615 13.7106 4.29444L12 1.33337L8.44934 7.48295L0.242432 21.6959H23.7576L19.3996 14.148ZM17.3474 5.38416C18.4167 5.66894 19.3064 6.35548 19.8606 7.31143C20.9499 9.19582 20.384 11.5859 18.6176 12.7931L14.4917 5.64797C15.3806 5.22055 16.3831 5.12734 17.3474 5.38416ZM12 4.45432L21.0533 20.135H15.7562L9.35029 9.04341L11.9995 4.45478L12 4.45432ZM2.94667 20.135L8.44888 10.6071L13.9511 20.135H2.94667Z"/>
</svg></span> Get a Percona Expert</a></p>
</div>
</div>









  



  <form class="md-feedback" name="feedback" hidden>
    <fieldset>
      <legend class="md-feedback__title">
        Was this page helpful?
      </legend>
      <div class="md-feedback__inner">
        <div class="md-feedback__list">
          
            <button class="md-feedback__icon md-icon" type="submit" title="This page was helpful" data-md-value="1">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m7 0c0 .8-.7 1.5-1.5 1.5S14 10.3 14 9.5 14.7 8 15.5 8s1.5.7 1.5 1.5m-5 7.73c-1.75 0-3.29-.73-4.19-1.81L9.23 14c.45.72 1.52 1.23 2.77 1.23s2.32-.51 2.77-1.23l1.42 1.42c-.9 1.08-2.44 1.81-4.19 1.81Z"/></svg>
            </button>
          
            <button class="md-feedback__icon md-icon" type="submit" title="This page could be improved" data-md-value="0">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10m-6.5-4c.8 0 1.5.7 1.5 1.5s-.7 1.5-1.5 1.5-1.5-.7-1.5-1.5.7-1.5 1.5-1.5M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m2 4.5c1.75 0 3.29.72 4.19 1.81l-1.42 1.42C14.32 16.5 13.25 16 12 16s-2.32.5-2.77 1.23l-1.42-1.42C8.71 14.72 10.25 14 12 14Z"/></svg>
            </button>
          
        </div>
        <div class="md-feedback__note">
          
            <div data-md-value="1" hidden>
              
              
                
              
              Thanks for your feedback!
            </div>
          
            <div data-md-value="0" hidden>
              
              
                
              
              Thank you for your feedback! Help us improve by using our  <a href="https://docs.google.com/forms/d/1bkWACehjqlwA0AKf-qTJcXvYbOSYgze8iTPXjntqmNo/edit" target="_blank" rel="noopener"> feedback form</a>.
            </div>
          
        </div>
      </div>
    </fieldset>
  </form>


                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      <a href="https://www.percona.com/about">Percona LLC</a> and its affiliates &copy; 2024 — <a href="#" onclick="Osano.cm.showDrawer('osano-cm-dom-info-dialog-open')">Cookie Preferences</a>
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["search.highlight", "navigation.top", "navigation.tracking", "content.tabs.link", "content.action.edit", "content.action.view", "content.code.copy"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
<script src="https://cmp.osano.com/Azqe5vTyLOSbN3OuT/49ad85b5-0418-4794-ab81-7599dddd534c/osano.js"></script>

      <script src="../assets/javascripts/bundle.081f42fc.min.js"></script>
      
        <script src="../js/promptremover.js"></script>
      
        <script src="../js/consent.js"></script>
      
    

  </body>
</html>